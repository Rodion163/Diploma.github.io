!function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(e,t,r){"use strict";function s(e,t){const r=document.createElement(e);return t.forEach(e=>{r.classList.add(e)}),r}r.d(t,"a",(function(){return s}))},function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c}));const s=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],i=["вс","пн","вт","ср","чт","пт","сб"];function n(e){return`${e.getDate()}, ${i[e.getDay()]}`}function a(e){return`${e.getDate()} ${s[e.getMonth()]}, ${e.getFullYear()}`}function o(e){return e<10?"0"+e:e}function c(e){return e.getFullYear()+"-"+o(e.getMonth()+1)+"-"+o(e.getDate())}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));const s="9e16fa8cb67e41e39aba5e0b42032cf4",i="https://newsapi.org"},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var s=r(1);class i{constructor(e,t){this._url=e,this._token=t}load(e,t,r){return fetch(`${this._url}/v2/everything?q=${e}&language=ru&page=1`+`&from=${Object(s.b)(r)}&to=${Object(s.b)(t)}&pageSize=100&apiKey=${this._token}`).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}}class n{constructor(e,t){this._url=e,this._token=t,this._api=new i(e,t)}_getCacheKey(e,t,r){return Object(s.b)(e)+","+Object(s.b)(t)+","+r}load(e,t,r){const s=localStorage.getItem(this._getCacheKey(t,r,e));return s?Promise.resolve(JSON.parse(s)):this._api.load(e,t,r).then(s=>(localStorage.setItem(this._getCacheKey(t,r,e),JSON.stringify(s)),s))}}},function(e,t,r){"use strict";r.r(t);r(5);var s=r(0),i=r(1),n=r(3),a=r(2);class o{constructor(e,t,r){this._input=r,t.addEventListener("submit",t=>{t.preventDefault(),""!==this._input.value&&e(r.value)})}setSearchText(e){this._input.value=e}}const c=document.querySelector("#form"),d=document.querySelector("#input"),l=new n.a(a.b,a.a);class h{constructor(e,t,r){this._preloader=e,this._preloaderLoading=e.querySelector(".preloader__loading"),this._preloaderResult=e.querySelector(".preloader__result"),this._cards=[],this._news=t,this._onLoadMoreClick=r,this._newsCards=t.querySelector(".news__cards"),this._button=t.querySelector("#moreButton"),t.querySelector("#moreButton").addEventListener("click",r)}_addCard(e,t,r,s,i,n){const a=new b(e,t,r,s,i,n);this._cards.push(a),this._newsCards.appendChild(a.card)}addCards(e){this._preloaderLoading.classList.add("preloader__loading_hidden"),this._preloaderResult.classList.add("preloader__result_hidden"),this._news.classList.remove("news_hidden"),e.forEach(e=>{this._addCard(e.urlToImage,e.description,e.publishedAt,e.title,e.source.name,e.url)})}clear(){this._cards.forEach(e=>{this._newsCards.removeChild(e.card)}),this._cards=[]}showLoading(){this._preloaderLoading.classList.remove("preloader__loading_hidden"),this._preloaderResult.classList.add("preloader__result_hidden"),this._news.classList.add("news_hidden")}showEmpty(){this._preloaderLoading.classList.add("preloader__loading_hidden"),this._preloaderResult.classList.remove("preloader__result_hidden"),this._news.classList.add("news_hidden")}setMoreVisible(e){this._button.classList.toggle("news__button_hidden",!e)}}const u=document.querySelector("#news"),_=document.querySelector("#preloader");class p{constructor(e,t,r){this._onLoadMoreClick=this._onLoadMoreClick.bind(this),this._onSearch=this._onSearch.bind(this),this._news=e,this._preloader=t,this._cardRendered=0,this._inputForm=new o(this._onSearch,c,d),this._loadResult=new h(t,e,this._onLoadMoreClick),this._analyticsLink=document.querySelector("#analyticsLink"),this._today=new Date,this._weekEarlier=new Date(this._today.valueOf()-6048e5),r&&(this._onSearch(r),this._inputForm.setSearchText(r))}_onLoadMoreClick(){l.load(this._searchText,this._today,this._weekEarlier).then(e=>{this._loadResult.addCards(e.articles.slice(this._cardRendered,this._cardRendered+3)),this._cardRendered+=3,this._loadResult.setMoreVisible(e.articles.length>this._cardRendered)})}_onSearch(e){this._searchText=e,this._loadResult.showLoading(),localStorage.setItem("lastQuery",this._searchText),l.load(e,this._today,this._weekEarlier).then(e=>{this._showResult(e)})}_showResult(e){this._analyticsLink.setAttribute("href",`./analytics.html?search=${encodeURIComponent(this._searchText)}`),history.pushState({},document.tite,`./index.html?search=${encodeURIComponent(this._searchText)}`),0==e.articles.length?this._loadResult.showEmpty():(this._loadResult.clear(),this._loadResult.addCards(e.articles.slice(0,3)),this._cardRendered=3,this._loadResult.setMoreVisible(e.articles.length>this._cardRendered))}}const f=new URL(location.href).searchParams.get("search"),g=localStorage.getItem("lastQuery");if(!f&&g)location.replace(`./index.html?search=${encodeURIComponent(g)}`);else{new p(u,_,f)}class b{constructor(e,t,r,s,i,n){this.urlToImage=e,this.description=t,this.publishedAt=r,this.title=s,this.sourceName=i,this.url=n,this.create()}create(){this.card=Object(s.a)("div",["card"]);const e=Object(s.a)("picture",[]),t=Object(s.a)("img",["card__image"]),r=Object(s.a)("div",["card__date"]),n=Object(s.a)("a",["card__title"]),a=Object(s.a)("p",["card__text"]),o=Object(s.a)("div",["card__source"]);t.setAttribute("src",this.urlToImage),n.setAttribute("href",this.url),n.setAttribute("target","_blank"),r.innerText=Object(i.a)(new Date(this.publishedAt)),n.innerText=this.title,a.innerText=this.description,o.innerText=this.sourceName,this.card.appendChild(e),e.appendChild(t),this.card.appendChild(r),this.card.appendChild(n),this.card.appendChild(a),this.card.appendChild(o)}}},function(e,t,r){}]);